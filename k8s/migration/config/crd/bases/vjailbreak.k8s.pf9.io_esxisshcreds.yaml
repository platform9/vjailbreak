---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.1
  name: esxisshcreds.vjailbreak.k8s.pf9.io
spec:
  group: vjailbreak.k8s.pf9.io
  names:
    kind: ESXiSSHCreds
    listKind: ESXiSSHCredsList
    plural: esxisshcreds
    singular: esxisshcreds
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.validationStatus
      name: Status
      type: string
    - jsonPath: .status.successfulHosts
      name: Successful
      type: integer
    - jsonPath: .status.failedHosts
      name: Failed
      type: integer
    - jsonPath: .status.totalHosts
      name: Total
      type: integer
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          ESXiSSHCreds is the Schema for the esxisshcreds API that defines SSH credentials
          for connecting to ESXi hosts. It validates SSH connectivity to ESXi hosts either
          discovered from vCenter via VMwareCreds or explicitly specified in the hosts list.
          The controller validates connections in parallel with throttling to avoid overwhelming
          the network, and reports per-host validation results in the status.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ESXiSSHCredsSpec defines the desired state of ESXiSSHCreds
            properties:
              hosts:
                description: |-
                  Hosts is an optional explicit list of ESXi host IPs or hostnames to validate
                  If both VMwareCredsRef and Hosts are specified, Hosts takes precedence
                items:
                  type: string
                type: array
              secretRef:
                description: |-
                  SecretRef is the reference to the Kubernetes secret holding the SSH private key
                  The secret should contain a key named "privateKey" with the SSH private key in PEM format
                properties:
                  apiVersion:
                    description: API version of the referent.
                    type: string
                  fieldPath:
                    description: |-
                      If referring to a piece of an object instead of an entire object, this string
                      should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                      For example, if the object reference is to a container within a pod, this would take on a value like:
                      "spec.containers{name}" (where "name" refers to the name of the container that triggered
                      the event) or if no container name is specified "spec.containers[2]" (container with
                      index 2 in this pod). This syntax is chosen only to have some well-defined way of
                      referencing a part of an object.
                    type: string
                  kind:
                    description: |-
                      Kind of the referent.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                    type: string
                  name:
                    description: |-
                      Name of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                    type: string
                  namespace:
                    description: |-
                      Namespace of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                    type: string
                  resourceVersion:
                    description: |-
                      Specific resourceVersion to which this reference is made, if any.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                    type: string
                  uid:
                    description: |-
                      UID of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                    type: string
                type: object
                x-kubernetes-map-type: atomic
              username:
                default: root
                description: 'Username is the SSH username to use for connecting to
                  ESXi hosts (default: "root")'
                type: string
              vmwareCredsRef:
                description: |-
                  VMwareCredsRef is the reference to the VMwareCreds object to discover ESXi hosts from
                  If specified, the controller will automatically discover all ESXi hosts from vCenter
                properties:
                  apiVersion:
                    description: API version of the referent.
                    type: string
                  fieldPath:
                    description: |-
                      If referring to a piece of an object instead of an entire object, this string
                      should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                      For example, if the object reference is to a container within a pod, this would take on a value like:
                      "spec.containers{name}" (where "name" refers to the name of the container that triggered
                      the event) or if no container name is specified "spec.containers[2]" (container with
                      index 2 in this pod). This syntax is chosen only to have some well-defined way of
                      referencing a part of an object.
                    type: string
                  kind:
                    description: |-
                      Kind of the referent.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                    type: string
                  name:
                    description: |-
                      Name of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                    type: string
                  namespace:
                    description: |-
                      Namespace of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                    type: string
                  resourceVersion:
                    description: |-
                      Specific resourceVersion to which this reference is made, if any.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                    type: string
                  uid:
                    description: |-
                      UID of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                    type: string
                type: object
                x-kubernetes-map-type: atomic
            required:
            - secretRef
            type: object
          status:
            description: ESXiSSHCredsStatus defines the observed state of ESXiSSHCreds
            properties:
              failedHosts:
                description: FailedHosts is the number of ESXi hosts that failed validation
                type: integer
              hostResults:
                description: HostResults contains the validation result for each ESXi
                  host
                items:
                  description: ESXiHostValidationResult holds the validation result
                    for a single ESXi host
                  properties:
                    esxiVersion:
                      description: ESXiVersion is the ESXi version if connection succeeded
                      type: string
                    hostname:
                      description: Hostname is the ESXi host IP or hostname
                      type: string
                    lastChecked:
                      description: LastChecked is the timestamp of the last validation
                        attempt
                      format: date-time
                      type: string
                    message:
                      description: Message contains details about the validation result
                        or error
                      type: string
                    status:
                      description: Status is the validation status for this host (Succeeded,
                        Failed)
                      type: string
                  required:
                  - hostname
                  - status
                  type: object
                type: array
              lastValidationTime:
                description: LastValidationTime is the timestamp of the last validation
                  run
                format: date-time
                type: string
              successfulHosts:
                description: SuccessfulHosts is the number of ESXi hosts that passed
                  validation
                type: integer
              totalHosts:
                description: TotalHosts is the total number of ESXi hosts to validate
                type: integer
              validationMessage:
                description: ValidationMessage is the message associated with the
                  overall validation
                type: string
              validationStatus:
                description: |-
                  ValidationStatus is the overall status of the ESXi SSH validation
                  Possible values: Pending, Validating, Succeeded, PartiallySucceeded, Failed
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
