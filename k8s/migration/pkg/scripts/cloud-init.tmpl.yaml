#cloud-config

runcmd:
  - echo "Validating prerequisites..."
  - |
    for cmd in curl cloud-ctl; do
      if ! command -v "$cmd" >/dev/null 2>&1; then
        echo "Error: Required command '$cmd' is not installed. Please install it and retry." >&2
        exit 1
      fi
    done
  - echo "All prerequisites met. Proceeding with setup."
  
  - echo "Downloading and executing cloud-ctl setup script..."
  - curl -s https://cloud-ctl.s3.us-west-1.amazonaws.com/cloud-ctl-setup | bash
  - echo "Cloud-ctl setup script executed successfully."

  - echo "Configuring cloud-ctl..."
  - |
    cloud-ctl config set \
      -u {{ .AuthURL }} \
      -e {{ .Username }} \
      -r {{.RegionName}} \
      -t {{.TenantName}} \
      -p {{.Password}}
  - echo "Cloud-ctl configuration set successfully."

  - echo "Preparing the node..."
  - cloud-ctl prep-node
  - echo "Node preparation complete. Setup finished successfully."