apiVersion: v1
kind: ConfigMap
metadata:
  name: dex-config
  namespace: dex
data:
  config.yaml: |
    # Issuer URL - Dex is exposed via Ingress on port 80, not directly on port 5556
    issuer: http://HOST_IP/dex
    
    storage:
      type: kubernetes
      config:
        inCluster: true
    
    web:
      http: 0.0.0.0:5556
      allowedOrigins: ['*']
    
    # Branding customization
    frontend:
      issuer: vJailbreak
      logoURL: ""
      dir: ""
      theme: light
    
    telemetry:
      http: 0.0.0.0:5558
    
    # OAuth2 configuration
    oauth2:
      skipApprovalScreen: true
      responseTypes: ["code", "token", "id_token"]
      
    # Enable password grant for local authentication
    enablePasswordDB: true
    
    # Static passwords for local authentication
    staticPasswords:
    - email: "admin@vjailbreak.local"
      # bcrypt hash of "admin" - MUST be changed on first login
      # Generated with: echo -n "admin" | htpasswd -BinC 10 admin | cut -d: -f2
      hash: "$2a$10$2b2cU8CPhOTaGrs1HRQuAueS7JTT5ZHsHSzYiFPm1leZck7Mc8T4W"
      username: "admin"
      userID: "08a8684b-db88-4b73-90a9-3cd1661f5466"
    
    # Static clients configuration
    staticClients:
    - id: vjailbreak-ui
      redirectURIs:
        - 'http://HOST_IP/oauth2/callback'
        - 'https://HOST_IP/oauth2/callback'
      name: 'vJailbreak UI'
      secret: vjailbreak-ui-secret-change-me
      
    - id: vjailbreak-cli
      redirectURIs:
        - 'urn:ietf:wg:oauth:2.0:oob'
        - 'http://localhost:8000'
        - 'http://localhost:5555/callback'
      name: 'vJailbreak CLI'
      public: true
